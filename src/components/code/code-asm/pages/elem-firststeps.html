<h1>Конспект канала First Steps</h1>


<!-- Содержание -->
<div class="article article__content">
  <h2>Содержание</h2>

  <p><a href="#links">links</a></p>
  <p><a href="#t0">Обязательная теория. Часть 0. Цели и задачи</a></p>
  <p><a href="#t1">Обязательная теория. Часть 1. Основные понятия</a></p>
  <p><a href="#t2">Обязательная теория. Часть 2. Код и Данные</a></p>
  <p><a href="#a0">MS-DOS и TASM 2.0. Часть 0. Программное обеспечение</a></p>
  <p><a href="#soft1">Скачать софт для программирования</a></p>
  <p><a href="#a1">MS-DOS и TASM 2.0. Часть 1. Кратко об MS-DOS</a></p>
  <p><a href="#a2">MS-DOS и TASM 2.0. Часть 2. Turbo Assembler</a></p>
  <p><a href="#install">install</a></p>
  <p><a href="#fasm64">fasm64</a></p>
  <p><a href="#pellesc">Pelles C</a></p>
  <p><a href="#small">Уменьшение размера исполняемого файла</a></p>
</div>


<!-- links -->
<article class="article">
  <div class="anchor" id="links"></div>
  <h3>links</h3>

  <ul>
    <li><a href="https://assembler-code.com">https://assembler-code.com</a></li>
    <li><a href="https://www.youtube.com/@firststepsforward/videos">https://www.youtube.com/@firststepsforward/videos</a></li>
  </ul>
</article>


<!-- Обязательная теория. Часть 0. Цели и задачи -->
<article class="article">
  <div class="anchor" id="t0"></div>
  <h3>Обязательная теория. Часть 0. Цели и задачи (2018.10.02)</h3>

  <h4>Просто о сложном</h4>
  <p>Информация излагается понятной для любого начинающего. Цель - показать, насколько просто научиться программировать самостоятельно при наличии времени и желания.</p>

  <h4>Ассемблер с нуля — практический подход</h4>
  <p>В качестве примеров будет рассмотрено написание конкретных простейших программ «хакерской» направленности, а также изучены основы крекинга (взлома программных защит), использования дизассемблированного кода в сторонних программах.</p>

  <h4>Наш план действий</h4>
  <ol>
    <li>Суть программирования.</li>
    <li>Понятие кода и данных на примере разработки простейших MS-DOS программы на Ассемблере с учётом возможностей простой, с точки зрения современности, операционной системы.</li>
    <li>Программирование Windows приложений на ассемблере и Си.</li>
    <li>Основы вирусологии — просто о сложном. Создание простейшего вируса и антивируса для Windows.</li>
    <li>Основы крэкинга. Исследование программ.</li>
    <li>Дизассемблирование — ассемблирование. Сложно ли «украсть» чужой код.</li>
    <li>Применение ассемблера и Си для создания современных Windows приложений.</li>
    <li>Итоги, выводы, применение полученных знаний и умений на практике.</li>
  </ol>
</article>


<!-- Обязательная теория. Часть 1. Основные понятия -->
<article class="article">
  <div class="anchor" id="t1"></div>
  <h3>Обязательная теория. Часть 1. Основные понятия (2018.10.08)</h3>

  <h4>Изучать программирование начнём с теории.</h4>
  <p>Для результативной работы начнём с теории: уясним и запомним задачи, решаемые с помощью создания кода, определение и основные структурные понятия программирования.</p>

  <h4>Задачи программирования</h4>
  <p>Программирование прежде всего предназначено для решения простой последовательности задач ввод информации в компьютер, обработка информации компьютером, вывод обработанной информации пользователю</p>

  <h4>Определение программирования</h4>
  <p>Машина понимает только язык цифр. Человеку более удобны понятные для него команды, отображаемые осмысленными словами, фразами, предложениями</p>
  <p>С помощью совокупности программ так называемой «среды программирования» программа, написанная на человекопонятном языке преобразуется в машинный код и машинные данные.</p>

  <h4>Основные структурные понятия программирования</h4>
  <p>Программирование включает в себя две основные взаимозависимые друг от друга составляющие части:</p>
  <ol>
    <li>Код.</li>
    <li>Данные.</li>
  </ol>
  <p>Код — совокупность указаний компьютеру обработать данные. Основная единица кода — функция.</p>
  <p>Данные — это информация в любом объеме и виде. Основная единица данных — бит.</p>
</article>


<!-- Обязательная теория. Часть 2. Код и Данные -->
<article class="article">
  <div class="anchor" id="t2"></div>
  <h3>Обязательная теория. Часть 2. Код и Данные (2018.10.09)</h3>

  <h4>Конкретизируем основные понятия программирования</h4>
  <p>Суть программирования — это эффективная работа с данными. Программирование — это совокупность двух не разрывных понятий — Кода и Данных.</p>

  <h4>Данные.</h4>
  <p>Данные представлены в следующем виде: переменные; константы.</p>
  <p>Данные могут быть сгруппированы для удобства их использования и обработки на: структуры.</p>
  <p>Разновидностями структур в современных языках программирования являются: перечисления; объединения; записи с битовыми полями; массивы; классы (в отличие от структуры, класс группирует и код, и данные).</p>
  <p>Разновидностью массива является (так сложилось исторически и до сих пор актуально): нультерминированная строка.</p>
  <p>Ключевым понятием, неотрывным от данных является: указатели.</p>

  <h4>Код.</h4>
  <p>Код представлен в виде: функции.</p>

  <h4>Единство Кода и Данных</h4>
  <p>Код и данные фактически представляют собой последовательности цифр. Таким образом, код можно рассматривать также как совокупность данных. Ведь любая функция — это для компьютера набор единиц и нулей</p>
  <p>Байт — единица кода и данных</p>
  <p>Бит — это единица информации. Так удобнее для машины. Компьютер не может напрямую работать с битом данных — только с байтом (8 бит — 256 вариантов значений).</p>

  <h4>Приступаем к практике</h4>
  <p>Программирование плотно связано с операционными системами. Начнём рассматривать программирование с написания программы под древнюю операционку MS-DOS.</p>
</article>


<!-- MS-DOS и TASM 2.0. Часть 0. Программное обеспечение -->
<article class="article">
  <div class="anchor" id="a0"></div>
  <h3>MS-DOS и TASM 2.0. Часть 0. Программное обеспечение (2018.10.14)</h3>

  <h4>Выбираем ассемблер для DOS</h4>
  <p>Изучать практическое программирование мы начнём с написания простейших программ для древней 16 битной  операционной системы MS-DOS. В этом нам поможет ассемблер для DOS — TASM (Turbo Assembler) от Borland. Для того времени — это самый популярный ассемблер с прекрасным функционалом и возможностями, в состав которого входит прекрасный для того времени отладчик TD (Turbo Debuger).</p>

  <h4>DOSBox или чистый DOS</h4>
  <p>Среда — операционная система MS-DOS. Мы обойдёмся виртуальной машиной, приспособленной для современного пользователя — DOSBox.</p>

  <h4>Необходимое программное обеспечение.</h4>
  <p>Основной софт, который нам понадобиться, чтобы бегло изучить ассемблер для DOS:</p>
  <ul>
    <li>TASM 2.0 (Turbo Assembler ver. 2.0)- 16 битный ассемблер для DOS фирмы Borland;</li>
    <li>TC 2.0 (Turbo C 2.0) — среда программирования и компилятор Си фирмы Borland;</li>
    <li>TD (Turbo Debugger) — отладчик фирмы Borland;</li>
    <li>SR (Sourcer) — популярный дизассемблер для DOS;</li>
    <li>IDA (Interractive Disassembler — DOS версия) — ещё один популярный дизассемблер;</li>
    <li>T-HELP — перечень прерываний (функций) MS-DOS в удобном виде.</li>
  </ul>
  <p>Вспомогательные программы:</p>
  <ul>
    <li>Hiew — очень популярный в свое время в среде программистов и хакеров редактор DOS с расширенными возможностями. Позволяет дизассемблировать код налету, вносить изменения и снова ассемблировать изменённый файл;</li>
    <li>TASMED — удобная среда программирования на ассемблере для DOS.</li>
  </ul>

  <h4>Устанавливаем пакет программ</h4>
  <p>Скачиваем архив DOS-1.rar и разархивируем. Должна появиться папка DOS, а в ней три директории: C, D, DOSBox. Заходим в пмпку DOSBox и кликаем на DOSBox.exe. Запустится эмулятор и автоматически — Norton Comander 5.0. Все необходимые программы установлены и настроены для наших целей. Директории C, D смонтированы как диски C:\, D:\ для удобства работы. На указанных дисках вы найдёте множество дополнительных утилит для удобства программирования в системе MS-DOS.</p>
</article>


<!-- Скачать софт для программирования -->
<article class="article">
  <div class="anchor" id="soft1"></div>
  <h3>Скачать софт для программирования (2018.10.14)</h3>

  <h4>Программное обеспечение для DOS</h4>
  <p>Операционная система MS-DOS широко используется до сих пор в целях обучения программированию и для запуска старых компьютерных игр. MS-DOS можно установить как на старом, так и на современном компьютере. Однако, чаще всего используют виртуальную машину DOSBox — практически не требующую установки и настройки.</p>

  <p>DOS-1.rar — пакет всего необходимого для программирования на ассемблере и Си в MS-DOS. Архив необходимо распаковать в отдельную папку (с названием, например, «DOS»). В папке должно быть три директории: C, D, DOSBox. В директории DOSBox запускаем DOSBox.exe и можно работать! Перечень программ: TASM 2.0 (Turbo Assembler ver. 2.0), TC 2.0 (Turbo C 2.0), TCPP 3.0 (Turbo C++ 3.0), TD (Turbo Debugger), SR (Sourcer), CV (CodeView), IDA (Interractive Disassembler — DOS версия), T-HELP, Hiew,  TASMED, DRWEBER, LEXICON, PAINT, NU (Norton Utils for DOS), NC 5.0 (Norton Commander 5.0). В папке WORK находятся исходники программ, рассмотренных в рубрике статей Ассемблер для DOS.</p>

  <h4>Программное обеспечение для Window.</h4>
  <ol>
    <li>FASM64.exe — пакет всего необходимого для программирования на ассемблере в Windows XP, 7, 8, 10, 11 (x86, x64). В сборку включены следующие программы.
    <p>Assemblers: fasm (x86, x64), masm32 (x86).</p>
    <p>Development environment: RadAsm 2.</p>
    <p>Debuger: xdbg (x86, x64).</p>
    <p>Utils: apimonitor (x86, x64), Depends, Hiew.v8.10 [Gun-Ryo Repack], Window Scanner, Process Monitor, Registry Workshop, WinHex, calc, winhlp32 insaller for Win 8, 10.</p>
    <p>Всё настроено для установки одним кликом в любую директорию. В процессе установки можно выбрать ассемблер для RadAsm 2 по-умолчанию. Впрочем, выбрать ассемблер всегда можно при создании нового проекта.</p>
    <p>RadAsm 2 — лучшая среда разработки для ассемблерных windows приложений. Настроить Microsoft Visual Studio Code под анологичный функционал и удобство пока не получается, MS VS также не дотягивает.</p>
    <p>Pass: assembler-code.com</p>
    </li>
    <li>Pelles C — это бесплатная интегрированная среда разработки и компилятор для языка C, работающая на операционных системах Microsoft Windows.
    <p>Pelles C включает в себя мощный компилятор, который поддерживает стандарт C и позволяет создавать высокопроизводительные приложения. Компилятор gcc. Поддерживает только С (С++ не поддерживает).</p>
    <p>Среда разработки предоставляет различные инструменты, такие как редактор ресурсов, инструмент для подписывания кода и интегрированный установщик, что делает процесс разработки более удобным и эффективным</p>
    <p>Pelles C позволяет разрабатывать приложения как для настольных ПК, так и для мобильных устройств на базе Windows.</p>
    <p>В архиве версии для Win98, WinXP, Win7(x86-x64), Win8-11 (setup.exe — поддержка x86-x64, ver. 12.00.2 — март 2024г.).</p>
    </li>
  </ol>
</article>


<!-- MS-DOS и TASM 2.0. Часть 1. Кратко об MS-DOS -->
<article class="article">
  <div class="anchor" id="a1"></div>
  <h3>MS-DOS и TASM 2.0. Часть 1. Кратко об MS-DOS (2018.10.15)</h3>

  <h4>Операционная система MS-DOS — необходимый минимум</h4>
  <p>Программирование на языке низкого уровня подразумевает знание операционной системы, для которой пишутся приложения. Операционная система — это основная программа, которая как минимум должна быть запущена на машине.</p>

  <h4>Файлы, папки, диски.</h4>
  <p>Операционная система MS-DOS работает с файлами, папками (по сути — подвиды файлов), дисками.</p>
  <p>Файлы делятся на виды:</p>
  <ol>
    <li>Исполняемые файлы.</li>
    <li>Файлы данных.</li>
  </ol>
  <p>Программа может состоять из одного исполняемого файла, а может включать в себя множество файлов.</p>

  <h4>Память</h4>
  <p>Код и данные в компьютере присутствуют в следующих видах памяти</p>
  <ol>
    <li>Жесткий диск. Работает медленно. Имеет большой объем. Данные остаются в памяти при перезагрузке компьютера</li>
    <li>Оперативная память. Работает быстро. Имеет маленький объем. Данные теряются при перезагрузке компьютера</li>
    <li>Кэш процессора. Память встроена в процессор. Работает очень быстро. Имеет очень маленький объем. Теряет данные при перезагрузке компьютера</li>
  </ol>
  <p>Операционная система делит оперативную память на различные участки по предназначению. В одни участки она записывает свои функции и данные, другие оставляет для пользовательских программ.</p>
  <p>При запуске исполняемого файла операционная система переписывает его с жёсткого диска в оперативную память. Но переписывает не копируя, а делая записи в определённой последовательности, в определённые места и в определённом объёме.</p>

  <h4>Структура памяти операционной системы MS-DOS</h4>
  <p><strong>00000 - 9FFFF</strong> 0 - 640Kb (640Kb) Conventional Memory</p>
  <p><strong>A0000 - EFFFF</strong> 640Kb - 960Kb (320Kb) UMA</p>
  <p><strong>F0000 - FFFFF</strong> 960Kb - 1Mb (64Kb) BIOS</p>
  <p><strong>100000 - 10FFEF</strong> HMA</p>

  <h4>Файлы данных и исполняемые файлы</h4>
  <p>Файлы данных в операционной системе MS-DOS могут иметь различные (практически любые) расширения (TXT, INI, MAC, ASM, CPP). С файлами данных работают исполняемые файлы.</p>
  <p>Информация в исполняемых файлах разбивается на сегменты. Один сегмент в системе MS-DOS не может превышать 64 Кбайта. Связано это с особенностями работы железа.</p>
  <p>Исполняемые файлы в системе MS-DOS бывают трёх видов, которые соответствуют расширениям:</p>
  <ol>
    <li>СОМ</li>
    <li>EXE</li>
    <li>BAT</li>
  </ol>
  <ol>
    <li>Файлы с расширением .COM состоят из одного сегмента, в котором размещаются код, данные и стек. В результате получаем крохотную, «сжатую» программу, размер которой не может превышать 64 Кбайта. В формате COM для системы MS-DOS можно писать любые программы — хватило бы места для данных и кода. Отдельные программы (обработчики прерываний, резидентные программы) обычно пишутся в формате COM.</li>
    <li>Файлы с расширением EXE для кода, данных и стека имеют отдельные сегменты. Число сегментов данных и кода не ограничено, что даёт возможность создания исполняемых файлов большого размера, не ограничивая объёмы кода и данных.</li>
    <li>Файлы с расширением BAT — «батники». Они также выполняют определённые действия, однако не являются полноценными исполняемыми программами. В батнике можно записать алгоритм запуска определённых файлов типа СОМ или EXE в определённой последовательности и при определённых условиях. Это очень удобно и экономит уйму времени, исключая монотонные и многочисленные действия пользователя.</li>
  </ol>

  <h4>Ядро системы MS-DOS.</h4>
  <p>Операционная система MS-DOS в своём минимальном стандартном виде состоит из следующих файлов:</p>
  <ol>
    <li>IO.SYS</li>
    <li>MSDOS.SYS</li>
    <li>COMMAND.COM</li>
    <li>AUTOEXEC.BAT</li>
    <li>CONFIG.SYS</li>
  </ol>
  <p>Причём файлы AUTOEXEC.BAT и CONFIG.SYS для запуска операционной системы не обязательны. Эти файлы являются предшественниками реестра Windows и содержат текстовые записи, позволяющие настроить загрузку системы при запуске (организовать меню загрузки, распределить память, запустить отдельные драйверы и программы).</p>
</article>


<!-- MS-DOS и TASM 2.0. Часть 2. Turbo Assembler -->
<article class="article">
  <div class="anchor" id="a2"></div>
  <h3>MS-DOS и TASM 2.0. Часть 2. Turbo Assembler (2018.10.21)</h3>

  <h4>Turbo Assembler — удачный пакет разработки DOS программ</h4>
  <p>Изучать ассемблер мы начнём со знаменитого TASM. В годы господства MS-DOS Турбо ассемблер от Borland был одним из самых распространённых средств создания программ, составляя конкуренцию MASM. Вначале не будем пользоваться средой программирования TASMED, а сделаем всё ручками, используя текстовый редактор и Турбо Ассемблер.</p>

  <h4>Этапы создания программы с использованием TASM</h4>
  <p>Создание программы, которая будет работать в операционной системе MS-DOS включает в себя следующие шаги:</p>
  <ol>
    <li>Написание кода(текстовый редактор или среда разработки).</li>
    <li>Трансляция (tasm.exe).</li>
    <li>Компановка или линковка (link.exe). Результат вышеназванных действий — создание исполняемого файла (EXE или COM).</li>
    <li>Отладка (отладчик Turbo Debugger, дезассемблер Sourcer или IDA).</li>
  </ol>




</article>


<!-- install -->
<article class="article">
  <div class="anchor" id="install"></div>
  <h3>install</h3>

  <h4>Установим среду разработки на ассемблере <strong>RedAsm</strong></h4>
  <ol>
    <li>
      <p>Заходим на сайт</p>
      <code><a href="https://assembler-code.com/programmnoe-obespechenie/">https://assembler-code.com/programmnoe-obespechenie/</a></code>
    </li>
    <li>
      <p>Скачиваем файл</p>
      <code>FASM64.exe</code>
    </li>
    <li>
      <p>Запускаем файл. Пароль к архиву как и название сайта</p>
      <code>assembler-code.com</code>
    </li>
    <li>
      <p>В конце установке запустится программа installer, которая спросит каким ассемблером мы будем пользоваться по умолчанию и выполнит соответствующие настройки RedAsm. Выбираем MASM32 - мы начнем с него. Впрочем, при создании проекта всегда можно выбрать любой другой ассемблер.</p>
    </li>
  </ol>

  <h4>Установим среду разработки для языка Си <strong>Pelles C</strong></h4>
  <ol>
    <li>
      <p>Заходим на сайт</p>
      <code><a href="https://www.smorgashbordet.com/pellesc/">https://www.smorgashbordet.com/pellesc/</a></code>
    </li>
    <li>
      <p>Скачиваем и устанавливаем в одну директорию с FASM64</p>
    </li>
  </ol>

  <h4>Почему RedAsm и Pelles C</h4>
  <ol>
    <li>Они неприхотливы к компьютеру</li>
    <li>Совместимы с ОС от Windows XP до Windows 11</li>
    <li>В них встроены программы для работы с ресурсами. Для удобного и быстрого решения наших задач</li>
    <li>Они имеют нормальные системы подсказок, автозаполнения кода</li>
    <li>Генерируют очень маленькие по размеру, необогащенные мусором программы, с ясным, неизбыточным кодом</li>
    <li>Их можно перенести в любую папку или даже на флешку</li>
  </ol>
</article>


<!-- fasm64 -->
<article class="article">
  <div class="anchor" id="fasm64"></div>
  <h3>fasm64</h3>

  <p>Основа пакета FASM64 среда разработки для ассемблера RedAsm. Это лучшая среда для Windows проектов на сегодняшний день. Она поддерживает практически все популярные ассемблеры, включая MASM32 и FASM. Которыми мы будем пользоваться и которые предустановлены и настроены в пакете. Имеются все необходимые утилиты для создания, изучения и работы с 32 и 64 битными программами для windows. Так что ничего искать и скачивать не придется.</p>

  <h4>Создадим программу в среде разработки RedAsm на языке ассемблера MASM32</h4>
  <ol>
    <li>
      <p>Запустим программу RedAsm</p>
      <code>FASM64\RedAsm2\RedAsm.exe</code>
    </li>
    <li>
      <p>Создадим новый проект. Выбираем меню</p>
      <code>File - New Project (Ctrl+Shift+N)</code>
    </li>
    <li>
      <p>Откроется окно Project Wizzard - Type & Name</p>
      <p>Выбираем ассемблер для нового проекта</p>
      <code>Assembler - masm</code>
      <p>Выбираем тип проекта</p>
      <code>Project Type - Win32 App</code>
      <p>Пишем название проекта</p>
      <code>Project Name - Hello</code>
      <code>Project - Hello</code>
      <p>По умолчанию выбрана директория проекта</p>
      <code>Project Folder - d:\Programs\FASM64\RadAsm2\Fasm\Projects\</code>
      <p>Но ее можно изменить и мы зададим свою</p>
      <code>Project Folder - D:\code\assembler</code>
      <p>Нажимаем кнопку</p>
      <code>Далее</code>
    </li>
    <li>
      <p>Откроется окно Project Wizzard - Template</p>
      <p>Выбираем шаблон</p>
      <code>MessageBox.tpl</code>
      <p>Нажимаем кнопку</p>
      <code>Далее</code>
    </li>
    <li>
      <p>Откроется окно Project Wizzard - Files & Folders</p>
      <p>Выберем файлы</p>
      <code>File Creation - Asm, Inc, Txt</code>
      <p>Нажимаем кнопку</p>
      <code>Далее</code>
    </li>
    <li>
      <p>Откроется окно Project Wizzard - Make</p>
      <p>Выбираем</p>
      <code>Make Menu - Assemble, Link, Buid, Go, Run, Run w/debug</code>
      <p>Нажимаем кнопку</p>
      <code>Готово</code>
    </li>
    <li>
      <p>В директории D:\code\assembler, которую мы выбрали создастся папка Hello. В папке Hello создадутся файлы Hello.Asm, Hello.Inc, Hello.rap и Hello.Txt</p>
    </li>
    <li>
      <p>В окне Project Browser нажимаем на файл</p>
      <code>Helo.Asm</code>
      <p>Файл откроется в окне редактора</p>
    </li>
    <li>
      <p>Мы увидим код первой программы</p>
<pre>.386
.model flat, stdcall
option casemap:none

include Hello.Inc

.code
start:
    invoke MessageBox, NULL, addr MsgBoxText, addr MsgCaption, MB_OK
    invoke ExitProcess, NULL
end start</pre>
      <p>Этот код директивой include включает еще и код из файл Hello.Inc</p>
<pre>include windows.inc
include kernel32.inc
include user32.inc
includelib user32.lib
includelib kernel32.lib

.data
MsgCaption      db "Smalest Prog",0
MsgBoxText      db "Win32 Assembly is Great!",0</pre>
    </li>
    <li>
      <p>Выполним ассемблирование</p>
      <p>На панели инструментов нажимаем кнопку</p>
      <code>Assemble</code>
      <p>То же самое можно сдлать выбрав пункт меню</p>
      <code>Make - Assemble (f5)</code>
      <p>В окне Output Window видим, что наш код Hello.Asm обработала программа ассемблер masm32\Bin\ML.EXE. Еще ее называют компоновщик или транслятор.</p>
      <p>Ассемблер ML.EXE создал объектный файл Hello.obj</p>
    </li>
    <li>
      <p>Выполним линковку</p>
      <p>Перед линковкой обязательно нужно делать ассемблирование, чтобы ассемблер создал объектный файл Hello.obj</p>
      <p>Выбираем пункт меню</p>
      <code>Make - Link (Alt+Ctrl+F5)</code>
      <p>В окне Output Window видим, что объектный файл Hello.obj обработала  программа компилятор masm32\Bin\LINK.EXE. Еще ее называют линковщик или сборщик.</p>
      <p>Компилятор LINK.EXE создал исполняемый файл Hello.exe</p>
    </li>
    <li>
      <p>Выполним компиляцию</p>
      <p>Выполнить компиляцию (ассемблирование и линковку) можно одной командой</p>
      <p>На панели инструментов нажимаем кнопку</p>
      <code>Build</code>
      <p>То же самое можно сдлать выбрав пункт меню</p>
      <code>Make - Build (Alt+Shift+F5)</code>
      <p>В окне Output Window видим, что сначала наш код Hello.Asm обработала  программа ассемблер masm32\Bin\ML.EXE, которая создала объектный файл Hello.obj. Затем объектный файл Hello.obj обработала программа линковщик masm32\Bin\LINK.EXE, которая создала исполняемый файл Hello.exe.</p>
      <p>Теперь программа скомпилирована и собрана. Для компиляции осуществляется два прохода - два этапа сборки программы. MASM32 использует компоновщик и линкер - это компиляция двумя проходами. FASM осуществляет один проход. Он включает в себя и компоновку и линковку.
      </p>
    </li>
    <li>
      <p>Запустим исполняемый файл Hello.exe</p>
      <p>На панели инструментов нажимаем кнопку</p>
      <code>Run</code>
      <p>То же самое можно сдлать выбрав пункт меню</p>
      <code>Make - Run (Ctrl+Shift+F5)</code>
    </li>
    <li>
      <p>Видим результат работы нашей программы. Открывается окно Smallest Prog с сообщением Win32 Assembly is Great! и кнопкой ОК</p>
    </li>
  </ol>

  <h4>Разберем код первой программы</h4>
  <h4>.386</h4>
  <p>Ассемблер использует инструкции доступные для процессора Intel 80386 и более новых. Можно изменить на .486 или .586</p>
  <h4>.model flat</h4>
  <p>Использование плоской модели памяти. Эту модель памяти использует Windows</p>
  <h4>stdcall</h4>
  <p>Определяет соглашение о вызове функций. Функция после вызова сама очищает стек. Параметры функции передаются через стек справа налево. Используется в языках программирования Си и C++ при работе с WinAPI</p>
  <h4>option casemap:none</h4>
  <p>Имена меток нечувствительны к регистру. Ассемблер будет одинаково воспринимать заглавные и строчные буквы</p>
  <h4>include Hello.Inc</h4>
  <p>На место этой строки в программе будет содержимое файла Hello.Inc</p>
  <p>Использование отдельных файлов для кода и отдельных для объявления функций, переменных, макросов, вложение библиотек предпочтительнее. Это облегчает написание сложных программ и говорит о высоком профессионализме</p>
  <h4>.code</h4>
  <p>Начало секции кода</p>
  <h4>.data</h4>
  <p>Секция данных</p>
  <h4>MsgCaption      db "Smalest Prog",0</h4>
  <p>Ноль-терминированная строка. Это строка которая оканчивается нулем.</p>
  <h4>start:</h4>
  <p>Начало секции кода</p>
  <h4>end start</h4>
  <p>Конец секции кода. Все что находится ниже этой строки ассемблером не воспринимается</p>
  <h4>invoke MessageBox</h4>
  <p>Функция Win32Api. Вызывает окно MessageBox</p>
  <h4>invoke ExitProcess</h4>
  <p>Функция Win32Api. Завершает процесс нашей программы. Программа корректно заканчивает свою работу в Windows</p>
</article>


<!-- pellesc -->
<article class="article">
  <div class="anchor" id="pellesc"></div>
  <h3>Pelles C</h3>

  <h4>Создадим программу в среде разработки Pelles C на языке Си</h4>
  <ol>
    <li>
      <p>Запустим программу Pelles C</p>
      <code>PellesC/Bin/poide.exe</code>
    </li>
    <li>
      <p>Создадим новый проект. Выбираем меню</p>
      <code>File - New - Project</code>
    </li>
    <li>
      <p>Откроется окно New project</p>
      <p>Выбираем пустой проект</p>
      <code>Empty projects - Win32 Program (EXE)</code>
      <p>Пишем название проекта</p>
      <code>Name - Hello</code>
      <p>По умолчанию выбрана директория проекта</p>
      <code>Location - d:\Programs\PellesC\MyProjects\Hello</code>
      <p>Но ее можно изменить и мы зададим свою</p>
      <code>Location - D:\code\c\</code>
      <p>Нажимаем кнопку</p>
      <code>OK</code>
    </li>
    <li>
      <p>В директории D:\code\c, которую мы выбрали создастся папка Hello. В папке Hello создадутся файлы Hello.ppj, Hello.ppx</p>
    </li>
    <li>
      <p>На вкладке Source files клик правой кнопкой мыши по файлу проекта Hello.ppj и выбираем</p>
      <code>Add files to project</code>
    </li>
    <li>
      <p>Откроется окно Add files. Напишем имя файла</p>
      <code>Имя файла - Hello.c</code>
      <p>Нажимаем кнопку</p>
      <code>Открыть</code>
    </li>
    <li>
      <p>В папке Hello появятся два новых файла Hello.c и Hello.tag</p>
      <p>На вкладке Source files появится папка Source files, а в ней файл Hello.c. Нажмем на него чтобы он открылся в окне редактора</p>
    </li>
    <li>
      <p>Напишем в нем первую программу</p>
<pre>#include &lt;windows.h&gt;
#pragma comment(linker, "/ENTRY:MyWinMain")

void MyWinMain()
{
  MessageBox(0, Win32 Assembly is Great!", "Smallest Prog", MB_OK);
  ExitProcess(0);
}</pre>
    </li>
    <li>
      <p>Выполним компиляцию</p>
      <p>На панели инструментов нажимаем кнопку</p>
      <code>Build</code>
      <p>То же самое можно сдлать выбрав пункт меню</p>
      <code>Project - Build (Ctrl+B)</code>
    </li>
    <li>
      <p>Компилятор создаст исполняемый файл , а также папку output с объектным файлом Hello.obj</p>
      <p>Запустим исполняемый файл Hello.exe</p>
      <p>На панели инструментов нажмем кнопку</p>
      <code>Execute</code>
      <p>То же самое можно сдлать выбрав пункт меню</p>
      <code>Project - Execute (Ctrl+F5)</code>
    </li>
    <li>
      <p>Видим результат работы нашей программы. Открывается окно Smallest Prog с сообщением Win32 Assembly is Great! и кнопкой ОК</p>
    </li>
  </ol>
</article>


<!-- Уменьшение размера исполняемого файла -->
<article class="article">
  <div class="anchor" id="small"></div>
  <h3>Уменьшение размера исполняемого файла</h3>

  <h4>1. Объединяем секции, удаляем ненужные</h4>
  <p>В каждом исполняемом файле линкером LINK.EXE создаются секции для кода, данных, импорта, экспорта, ресурсов. Они могут иметь названия .text, .rdata, .data, .reloc и другие. Даже если в этих секциях нет необходимости, они будут по умолчанию создаваться линкером. Эти секции можно объединять в одну. Или давать команду линкеру не создавать конкретную секцию. Размер файла существенно уменьшится. Практически, безопасно данные помещать в секцию кода. Это затрудняет отладку исполняемых файлов, что является одним из способов защиты от взлома.</p>
  <p>После того как мы создали первую программу на ассемблере, у нас есть исполняемый файл Hello.exe. Откроем его в текстовом редакторе с кодировкой ANSII.</p>

  <h4>2. Задаем минимальное число выравнивания секций</h4>
  <p>Каждая секция выравнивается в памяти на значение, кратное определенному числу. По умолчанию это значение 4096 для 32 битной системы. Указатель на первый байт секции, даже если в ней не будет данных переместится на адрес кратный 4096. Данные будут проецироваться напрамую в память из нашего файла. Если изменить кратность выравнивания, изменится как проецируемый файл в памяти, так и файл на жестком диске. Минимальное значение выравнивания в 32 битной системе 16 байт. При помощи линкера LINK.EXE можно установить минимальное значение выравнивания.</p>

  <h4>3. Убираем уведомление для DOS</h4>
  <p>В начале любого исполняемого файла в среде Windows есть секция с фразой This program cannot be run in DOS mode. Этот текст выведет консоль если файл запустят в системе DOS. В линкере можно убрать вывод этого текста.</p>

  <h4>4. Используем Win32API</h4>
  <p>В коде надо использовать функции, содержащиеся в самой операционке, библиотеках dll, а не писать свой код. При вызове функций Win32API, код функций берется из библиотеки dll, его нет в коде нашей программы, что также уменьшает ее размер.</p>

  <h4>5. Используем секцию .data? (для MASM32)</h4>
  <p>При написании больших программ, необходимо, если возможно, выделять память динамически. Или размещать в ней инициализированные данные в специальной секции <strong>.data?</strong> а не в секции данных <strong>.data</strong></p>

  <h4>6. Применяем неординарные способы</h4>
  <p>Применять неординарные способы уменьшения размера программ. Например грубая обрезка файла.</p>

  <h4>Переходим к Практике</h4>
  <p>Линковщик ассемблера использует только командную строку. А линковщик PellesC поддерживает директиву #pragma, что очень удобно</p>
</article>

