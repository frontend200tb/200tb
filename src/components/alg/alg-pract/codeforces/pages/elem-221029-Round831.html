<article class="article">
  <a href="https://codeforces.com/contest/1740" target="_blank">Codeforces 1740 Round 831 (Div. 1 + Div. 2) 2022-10-29</a>
</article>


<!-- Содержание -->
<article class="article">
  <h2>Содержание</h2>

      <a href="#task1">Задача A. Факторизуйте N+M</a>
  <br><a href="#task2">Задача B. Много лишнего сыра 2</a>
  <br><a href="#task3">Задача C. Кубики и мешки</a>
  <br><a href="#task4">Задача D. Карты знаний</a>
  <br><a href="#task5">Задача E. Подвешенные сердца</a>
  <br><a href="#task6">Задача F. Ограниченное смешивание</a>
  <br><a href="#task7">Задача G. Опасные лазеры</a>
  <br><a href="#task8">Задача H. MEX и манипуляции с деревом</a>
  <br><a href="#task9">Задача I. Хрустальные шары</a>
</article>


<!-- Задача A. Факторизуйте N+M -->
<article class="article">
  <div class="anchor" id="task1"></div>
  <h3>Задача A. Факторизуйте N+M</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

  <p>У Пака Чанека есть простое число† n. Найдите простое число m такое, что n+m не является простым.</p>

  <p>† Простое число — это число с ровно 2 множителями. Первые несколько простых чисел: 2,3,5,7,11,13,…. В частности, 1 не является простым числом.</p>

  <h4>Входные данные</h4>
  <p>Каждый тест содержит несколько наборов входных данных. Первая строка содержит целое число t (1 ≤ t ≤ 10⁴) — количество наборов входных данных. Следующие строки содержат описания наборов.</p>

  <p>Единственная строка каждого набора входных данных содержит простое число n (2 ≤ n ≤ 10⁵).</p>

  <h4>Выходные данные</h4>
  <p>Для каждого набора входных данных выведите строку, содержащую простое число m (2 ≤ m ≤ 10⁵) такое, что n+m не является простым. Можно доказать, что при ограничениях задачи такие m всегда существуют.</p>

  <p>Если решений несколько, можно вывести любое из них.</p>

  <details>
    <summary>Пример</summary>
<pre>
3
7
2
75619
</pre>
<pre>
2
7
47837
</pre>
  <p>В первом наборе входных данных m=2 — простое число, а n+m=7+2=9 — не простое.</p>
  <p>Во втором наборе входных данных m=7 — простое число, а n+m=2+7=9 — не простое.</p>
  <p>В третьем наборе входных данных m=47837 — простое число, а n+m=75619+47837=123456 — не простое.</p>
  </details>

  <details>
    <summary>Решение</summary>
<pre>
#include &lt;iostream&gt;

using namespace std;

bool prime(long long p) {
  if (p &lt;= 1) {
    return false;
  }
  for (long long i = 2; i * i &lt;= p; i++) {
    if (p % i == 0) {
      return false;
    }
  }
  return true;
}

int main() {
// условная компиляция
#ifdef _DEBUG
  freopen("input.txt", "rt", stdin);
  freopen("output.txt", "wt", stdout);
#endif

  // число тестов
  int t;
  cin >> t;

  while (t--) {
    // ввод данных
    int n; // простое число
    cin >> n;

    // решение
    for (int i = 2; i &lt; 1e5; i++) {
      if (prime(i) && !prime(i + n)) {
        cout &lt;&lt; i &lt;&lt; '\n';
        break;
      }
    }
  }

}
</pre>
  </details>
</article>


<!-- Задача B. Много лишнего сыра 2 -->
<article class="article">
  <div class="anchor" id="task2"></div>
  <h3>Задача B. Много лишнего сыра 2</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

  <p>У Пака Чанека есть n двухмерных ломтиков сыра. i-й ломтик сыра можно представить в виде прямоугольника размерами aᵢ x bᵢ. Мы хотим расположить их на двумерной плоскости так, чтобы:</p>
  <ul>
    <li>Каждая грань каждого ломтика сыра параллельна либо оси x, либо оси y.</li>
    <li>Нижняя грань каждого ломтика — это отрезок на оси x.</li>
    <li>Никакие два ломтика не пересекаются, но они могут соприкасаться гранями.</li>
    <li>Они образуют одну связанную фигуру.</li>
  </ul>

  <p>Обратите внимание, что мы можем расположить их в любом порядке (крайний левый ломтик сыра не обязательно является первым ломтиком сыра). Также обратите внимание, что мы можем вращать каждый ломтик сыра любым способом при условии выполнения остальных ограничений.</p>

  <p>Найдите минимально возможный периметр построенной фигуры.</p>

  <h4>Входные данные</h4>
  <p>Каждый тест содержит несколько наборов входных данных. Первая строка содержит целое число t (1 ≤ t ≤ 2⋅10⁴) — количество наборов входных данных. Следующие строки содержат описания наборов входных данных.</p>

  <p>Первая строка каждого набора входных данных содержит целое число n (1 ≤ n ≤ 2⋅10⁵) — количество ломтиков сыра у Пака Чанека.</p>

  <p>В i-й из следующих n строк каждого набора содержатся два целых числа aᵢ и bᵢ (1 ≤ aᵢ, bᵢ ≤ 10⁹) — размеры i-го ломтика сыра.</p>

  <p>Гарантируется, что сумма n по всем наборам входных данных не превосходит 2⋅10⁵.</p>

  <h4>Выходные данные</h4>
  <p>Для каждого набора входных данных выведите строку, содержащую целое число — минимально возможный периметр построенной фигуры.</p>

  <details>
    <summary>Пример</summary>
<pre>
3
4
4 1
4 5
1 1
2 3
3
2 4
2 6
2 3
1
2 65
</pre>
<pre>
26
24
134
</pre>
  <p>В первом наборе входных данных один из способов получения минимально возможного периметра выглядит следующим образом. 3x2, 4x5,4x1,1x1</p>
  <p>Мы можем вычислить периметр построенной фигуры: 2+5+1+1+1+1+3+1+5+1+2+3=26. Можно показать, что нельзя получить меньший периметр.</p>
  <p>Ниже показано некорректное расположение. 3x2,1x1,4x1,5x4</p>
  <p>Периметр данной фигуры 24, но не все ограничения в задаче выполнены. Нижняя грань ломтика 1x1 не находится на оси x.</p>
  <p>Во втором наборе входных данных один из способов получения минимально возможного периметра выглядит следующим образом. 4x2,6x3,3,2</p>
  <p>Мы можем вычислить периметр построенной фигуры: 2+2+2+3+2+3+2+2+2+4=24. Можно показать, что нельзя получить меньший периметр.</p>
  </details>
</article>


<!-- Задача C. Кубики и мешки -->
<article class="article">
  <div class="anchor" id="task3"></div>
  <h3>Задача C. Кубики и мешки</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

  <p>Есть n кубиков, пронумерованных от 1 до n. Кубик i имеет вес ai.</p>

  <p>У Пака Чанека есть 3 мешка с номерами от 1 до 3, которые изначально пусты. Каждый кубик Пак Чанек должен положить в один из мешков. После этого в каждом мешке должен оказаться хотя бы один кубик.</p>

  <p>После того, как Пак Чанек разложит кубики, Бу Денгклек возьмет ровно по одному кубику из каждого мешка. Пусть wj — вес кубика, который Бу Денгклек берет из мешка j. Результатом всех действий назовем число |w1-w2|+|w2-w3|, где |x| — модуль числа x.</p>

  <p>Известно, что Денгклек будет брать кубики таким образом, чтобы минимизировать результат. Чему равен максимально возможный результат, если Пак Чанек раскладывает кубики оптимально?</p>

  <h4>Входные данные</h4>
  <p>Каждый тест содержит несколько наборов входных данных. Первая строка содержит целое число t (1 ≤ t ≤ 2⋅10⁴) — количество наборов. Следующие строки содержат описание каждого набора.</p>

  <p>Первая строка каждого набора входных данных содержит целое число n (3 ≤ n ≤ 2⋅10⁵) — количество кубиков.</p>

  <p>Вторая строка каждого набора содержит n целых чисел a1, a2, …, an (1 ≤ ai ≤ 10⁹) — веса кубиков.</p>

  <p>Гарантируется, что сумма n по всем наборам входных данных не превосходит 2⋅10⁵.</p>

  <h4>Выходные данные</h4>
  <p>Для каждого теста выведите строку, содержащую целое число, представляющее максимально возможный результат, если Пак Чанек оптимально разложит кубики.</p>

  <details>
    <summary>Пример</summary>
<pre>
3
5
3 1 5 2 3
4
17 8 19 45
8
265 265 265 265 265 265 265 265
</pre>
<pre>
6
63
0
</pre>
  <p>В первом наборе входных данные, один из вариантов получить итоговый результат, равный 6, выглядит следующим образом:</p>
  <ul>
    <li>Положить кубики 1, 4, и 5 в мешок 1.</li>
    <li>Положить кубик 3 в мешок 2.</li>
    <li>Положить кубик 2 в мешок 3.</li>
  </ul>
  <p>Если Пак Чанек разложит кубики таким образом, то Денгклек может взять кубики следующим образом:</p>
  <ul>
    <li>Взять кубик 5 из мешка 1.</li>
    <li>Взять кубик 3 из мешка 2.</li>
    <li>Взять кубик 2 из мешка 3.</li>
  </ul>
  <p>Результат равен |a5-a3|+|a3-a2|=|3-5|+|5-1|=6. Можно показать, что Бу Денгклек не может получить меньший результат при таком распределении кубиков.</p>
  <p>Можно показать, что нет другого распределения кубиков, которое дает результат больший, чем 6.</p>
  </details>
</article>


<!-- Задача D. Карты знаний -->
<article class="article">
  <div class="anchor" id="task4"></div>
  <h3>Задача D. Карты знаний</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

  <p>Пак Чанек, известный ученый, изобрел карточную головоломку, используя свои знания. В головоломке вам дается поле с n строками и m столбцами. Пусть (r,c) обозначает ячейку в r-й строке и c-м столбце.</p>

  <p>Изначально в ячейке (1,1) стопкой лежат k карт. На каждой карте написано целое число от 1 до k. А именно, на i-й сверху карте в стопке в ячейке (1,1) написано число ai. Известно, что не существует двух карт с одинаковыми числами. Другими словами, числа, написанные на картах, представляют собой перестановку целых чисел от 1 до k. Все остальные ячейки пусты.</p>

  <p>Вам нужно переместить все k карт в ячейку (n,m), чтобы составить другую стопку карт. Пусть bi — число, написанное на i-й сверху карте в стопке в ячейке (n,m). Вы должны составить стопку в ячейке (n,m) таким образом, чтобы bi = i для всех 1 ≤ i ≤ k.</p>

  <p>За один ход вы можете взять верхнюю карту из любой ячейки и положить ее на соседнюю ячейку (ячейку, имеющую общую сторону). Если ячейка, в которую вы собираетесь положить карту, уже содержит одну или несколько карт, вы кладете свою карту на вершину стопки. Вы должны выполнять каждую операцию, соблюдая следующие ограничения:</p>
  <ul>
    <li>Каждая ячейка, отличная от (1,1) и (n,m), должна всегда содержать не более одной карты.</li>
    <li>Вы не можете перемещать карту в ячейку (1,1).</li>
    <li>Вы не можете перемещать карту из ячейки (n,m).</li>
  </ul>
   <p>По заданным значениям n, m, k и массиву a, определите, разрешима ли головоломка.</p>

  <h4>Входные данные</h4>
  <p>Каждый тест содержит несколько наборов входных данных. Первая строка содержит целое число t (1 ≤ t ≤ 2⋅10⁴) — количество наборов входных данных. Следующие строки содержат описание наборов входных данных.</p>

  <p>Первая строка каждого набора содержит три целых числа n, m и k (3 ≤ n, m ≤ 10⁶, nm ≤ 10⁶, 1 ≤ k ≤ 10⁵) — размеры поля и количество карт.</p>

  <p>Вторая строка набора содержит k целых чисел a1, a2, …, ak — массив a, содержащий числа, написанные на картах. Значения a представляют собой перестановку целых чисел от 1 до k.</p>

  <p>Гарантируется, что сумма nm и сумма k по всем наборам входных данных не превышают 10⁶ и 10⁵ соответственно.</p>

  <h4>Выходные данные</h4>

  <p>Для каждого набора входных данных выведите «YA» (без кавычек), если головоломка имеет решение, и «TIDAK» (без кавычек) иначе, что означает «да» и «нет» соответственно в индонезийском языке.</p>
  <p>Вы можете выводить «YA» и «TIDAK» в любом регистре (например, строки «tiDAk», «tidak» и «Tidak» будут восприняты как отрицательный ответ).</p>

  <details>
    <summary>Пример</summary>
<pre>
4
3 3 6
3 6 4 1 2 5
3 3 10
1 2 3 4 5 6 7 8 9 10
5 4 4
2 1 3 4
3 4 10
10 4 9 3 5 6 8 2 7 1
</pre>
<pre>
YA
TIDAK
YA
YA
</pre>
  <p>В первом наборе входных данных головоломка может быть решена следующим образом:</p>
  <ul>
    <li>Переместить карту с написанной на ней 3 из ячейки (1,1) в ячейку (1,2), затем в (1,3).</li>
    <li>Переместить карту с написанной на ней 6 из ячейки (1,1) в ячейку (2,1), затем в (3,1), затем в (3,2), затем в (3,3).</li>
    <li>Переместить карту с написанной на ней 4 из ячейки (1,1) в ячейку (1,2).</li>
    <li>Переместить карту с написанной на ней 1 из ячейки (1,1) в ячейку (2,1), затем в (2,2), затем в (2,3) .</li>
    <li>Переместить карту с написанной на ней 2 из ячейки (1,1) в ячейку (2,1), затем в (2,2).</li>
    <li>Переместить карту с написанной на ней 5 из ячейки (1,1) в ячейку (2,1), затем в (3,1), затем в (3,2), затем в (3,3).</li>
    <li>Переместить карту с написанной на ней 2 из ячейки (2,2) в ячейку (2,1).</li>
    <li>Переместить карту с написанной на ней 4 из ячейки (1,2) в ячейку (2,2), затем в (3,2), затем в (3,3).</li>
    <li>Переместить карту с написанной на ней 3 из ячейки (1,3) в ячейку (1,2), затем в (2,2), затем в (3,2), затем в (3,3).</li>
    <li>Переместить карту с написанной на ней 2 из ячейки (2,1) в ячейку (3,1), затем в (3,2), затем в (3,3).</li>
    <li>Переместить карту с написанной на ней 1 из ячейки (2,3) в ячейку (3,3).</li>
  </ul>
  <p>Анимированная иллюстрация процесса, описанного выше, выглядит следующим образом:</p>
  </details>
</article>


<!-- Задача E. Подвешенные сердца -->
<article class="article">
  <div class="anchor" id="task5"></div>
  <h3>Задача E. Подвешенные сердца</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

  <p>У Пака Чанека есть n пустых карточек в форме сердца. Карточка 1 прикреплена непосредственно к стене, остальные же карточки подвешены ровно к одной другой карточке верёвочкой. А именно, карточка i (i > 1) подвешена к карточке pi (pi &lt; i).</p>

  <p>Пак Чанек должен написать на каждой карточке одно целое число. Для этого он выберет произвольную перестановку a чисел [1, 2, …, n], и на карточке i запишет число ai.</p>

  <p>После этого Пак Чанек должен выполнить следующую операцию n раз, поддерживая при этом последовательность s (изначально пустую):</p>
  <ol>
    <li>Выбрать такую карточку x, что к ней не подвешена ни одна другая карточка. </li>
    <li>Добавить число, записанное на карте x, в конец последовательности s.</li>
    <li>Если x ≠ 1 и число на карточке px больше, чем число на карточке x, заменить число на карточке px на число на карточке x.</li>
    <li>Удалить карточку x.</li>
  </ol>
  <p>После этого у Пака Чанека будет последовательность s из n элементов. Какова максимальная длина наибольшей неубывающей подпоследовательности† s в конце, если Пак Чанек выполняет все шаги оптимально?</p>

  <p>† Последовательность b называется подпоследовательностью последовательности c если b может быть получена из c удалением некоторого (возможно нулевого) количества элементов. Например, [3,1] — подпоследовательность [3,2,1], [4,3,1] и [3,1], но не [1,3,3,7] и не [3,10,4].</p>

  <h4>Входные данные</h4>
  <p>Первая строка содержит одно целое число n (2 ≤ n ≤ 10⁵) — количество карточек.</p>

  <p>Вторая строка содержит n-1 целое число p2, p3, …, pn (1 ≤ pi &lt; i) описывающая, к какой карточке подвешена каждая карточка.</p>

  <h4>Выходные данные</h4>
  <p>Выведите одно целое число — максимальную длину наибольшей неубывающей подпоследовательности s в конце, если Пак Чанек сделает все шаги оптимально.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
6
1 2 1 4 2
</pre>
  <code>4</code>

    <h4>Пример 2</h4>
<pre>
2
1
</pre>
  <code>2</code>
  <p>Ниже представлена структура карточек в первом примере.</p>
  <p>Пак Чанек может выбрать перестановку a=[1,5,4,3,2,6].</p>
  <p>Пусть wi — число на карточке i. Изначально wi=ai.</p>
  <p>Пак Чанек может выполнять следующие операции по порядку:</p>
  <ol>
    <li>Выбрать карточку 5. Добавить w5 = 2 в конец s. Так как w4 > w5, значение w4 становится равным 2. Удаляем карточку 5. После этой операции s = [2].</li>
    <li>Выбрать карточку 6. Добавить w6 = 6 в конец s. Так как w2 ≤ w6, значение w2 остается неизменным. Удаляем карточку 6. После этой операции s = [2,6].</li>
    <li>Выбрать карточку 4. Добавить w4 = 2 в конец s. Так как w1 ≤ w4, значение w1 остается неизменным. Удаляем карточку 4. После этой операции s = [2,6,2].</li>
    <li>Выбрать карточку 3. Добавить w3 = 4 в конец s. Так как w2 > w3, значение w2 становится равным 4. Удаляем карточку 3. После этой операции s = [2,6,2,4] .</li>
    <li>Выбрать карточку 2
      . Добавить w2 = 4 в конец s. Так как w1≤w2, значение w1 is left unchanged. Удаляем карточку 2. После этой операции s = [2,6,2,4,4].</li>
    <li>Выбрать карточку 1. Добавить w1 = 1 в конец s. Удаляем карточку 1. После этой операции s = [2,6,2,4,4,1].</li>
  </ol>
  <p>Одна из наибольших неубывающих подпоследовательностей s=[2,6,2,4,4,1] это [2,2,4,4]. Таким образом, длина наибольшей неубывающей подпоследовательности s равна 4. Можно доказать, что это действительно максимально возможная длина.</p>
  </details>
</article>


<!-- Задача F. Ограниченное смешивание -->
<article class="article">
  <div class="anchor" id="task6"></div>
  <h3>Задача F. Ограниченное смешивание</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 512мб</i></div>

  <p>Паку Чанаку дан массив a из n целых чисел. Для каждого i (1 ≤ i ≤ n) Пак Чанак пишет на доске одноэлементное множество {ai}.</p>

  <p>После этого за одну операцию Пак Чанак может сделать следующее:</p>
  <ol>
    <li>Выбрать два различных множества S и T на доске таких, что S∩T=∅ (S и T не имеют общих элементов).</li>
    <li>Стереть S и T с доски и записать S∪T (объединение S и T) на доску.</li>
  </ol>
  <p>Выполнив ноль или более операций, Пак Чанак построит мультимножество M, содержащее размеры всех множеств, написанных на доске. Другими словами, каждый элемент в M соответствует размеру некоторого множества после операций.</p>

  <p>Сколько различных† мультимножеств M может быть получено таким процессом? Так как ответ может быть большим, выведите его по модулю 998244353.</p>

  <p>† Мультимножества B и C различны тогда и только тогда, когда существует значение k такое, что количество элементов со значением k в B отличается от количества элементов со значением k в C.</p>

  <h4>Входные данные</h4>
  <p>Первая строка содержит целое число n (1 ≤ n ≤ 2000).</p>

  <p>Вторая строка содержит n целых чисел a1, a2, …, an (1 ≤ ai ≤ n).</p>

  <h4>Выходные данные</h4>
  <p>Выведите количество различных мультимножеств M по модулю 998244353.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
6
1 1 2 1 4 3
</pre>
  <code>7</code>

    <h4>Пример 2</h4>
<pre>
7
3 5 4 3 7 4 5
</pre>
  <code>11</code>
  <p>В первом примере возможные мультимножества M таковы: {1,1,1,1,1,1}, {1,1,1,1,2}, {1,1,1,3}, {1,1,2,2}, {1,1,4}, {1,2,3} и {2,2,2}.</p>
  <p>В качестве примера рассмотрим возможную последовательность операций.</p>
  <ol>
    <li>Вначале множества имеют вид {1}, {1}, {2}, {1}, {4} и {3}.</li>
    <li>Применяем операцию ко множествам {1} и {3}. Теперь множества на доске имеют вид {1}, {1}, {2}, {4} и {1,3}.</li>
    <li>Применяем операцию ко множествам {2} and {4}. Теперь множества на доске имеют вид {1}, {1}, {1,3} и {2,4}.</li>
    <li>Применяем операцию ко множествам {1,3} and {2,4}. Теперь множества на доске имеют вид {1}, {1} и {1,2,3,4}.</li>
    <li>Полученное мультимножество M имеет вид {1,1,4}.</li>
  </ol>
  </details>
</article>


<!-- Задача G. Опасные лазеры -->
<article class="article">
  <div class="anchor" id="task7"></div>
  <h3>Задача G. Опасные лазеры</h3>

  <div><i>Ограничение по времени 4с
  <br>Ограничение по памяти 512мб</i></div>

  <p>У Пака Чанека есть сетка из порталов размера nxm. Портал в i-й строке и j-м столбце обозначается как портал (i,j). Порталы (1,1) и (n,m) находятся в северо-западном и юго-восточном углах сетки соответственно.</p>

  <p>Портал (i,j) имеет две настройки:</p>
  <ul>
    <li>Тип ti,j, который может быть 0 или 1.</li>
    <li>Сила si,j, являющаяся целым числом от 1 до 109 включительно.</li>
  </ul>

  <p>Каждый портал имеет 4 грани, помеченные целыми числами 0,1,2,3, которые соответствуют направлениям на север, восток, юг и запад соответственно.</p>
  <p>Когда лазерный луч входит в грань k портала (i,j) со скоростью xin, он покидает портал из грани (k+2+ti,j)mod4 со скоростью xout=max(xin,si,j). Портал при этом потребляет xout-xin единиц энергии.</p>

  <p>Паку Чанеку сегодня очень скучно. Он собирается запустить 4nm лазерных лучей с начальной скоростью 1, по одному в каждую грань каждого портала. Каждый луч будет перемещаться по этой сетке порталов, пока не выйдет за пределы сетки или не пройдет через 10100 порталов.</p>

  <p>Пак Чанек считает, что портал хороший тогда и только тогда, когда суммарная энергия, потребленная этим порталом по модулю 2, равна его типу. Учитывая настройки силы всех порталов, найдите способ назначить настройки типа каждого портала таким образом, чтобы количество хороших порталов было максимально возможным.</p>

  <h4>Входные данные</h4>
  <p>Первая строка содержит два целых числа n и m (1 ≤ n, m ≤ 1000) — количество строк и столбцов в сетке.</p>

  <p>В i-й из следующих n строк содержатся m целых чисел, j-е целое число — значение si, j (1 ≤ si,j ≤ 109), сила портала (i,j).</p>

  <h4>Выходные данные</h4>
  <p>Выведите n строк, каждая их которых состоит из m символов 0 или 1, обозначающих тип портала, где j-й символ в i-й строке это настройка типа портала (i,j).</p>

  <p>Если решений несколько, выведите любое из них.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
2 3
8 8 2
6 5 7
</pre>
<pre>
110
100
</pre>

    <h4>Пример 2</h4>
<pre>
1 2
420 69
</pre>
<pre>
10
</pre>
  <p>В первом примере рассмотрим лазерный луч, который Пак Чанек запускает в грань 1 портала (2,2). Луч перемещается следующим образом:</p>
  <ol>
    <li>Луч входит в грань 1 портала (2,2) со скоростью 1. Он покидает портал из грани 3 со скоростью 5. Портал (2,2) потребляет 4 единиц энергии.</li>
    <li>Луч входит в грань 1 портала (2,1) со скоростью 5. Он покидает портал из грани 0 со скоростью 6. Портал (2,1) потребляет 1 единиц энергии.</li>
    <li>Луч входит в грань 2 портала (1,1) со скоростью 6. Он покидает портал из грани 1 со скоростью 8. Портал (1,1) потребляет 2 единиц энергии.</li>
    <li>Луч входит в грань 3 портала (1,2) со скоростью 8. Он покидает портал из грани 2 со скоростью 8. Портал (1,2) потребляет 0 единиц энергии.</li>
    <li>Луч входит в грань 0 портала (2,2) со скоростью 8. Он покидает портал из грани 2 со скоростью 8. Портал (2,2) потребляет 0 единиц энергии.</li>
  </ol>
  <p>Иллюстрация перемещений луча, описанных выше, выглядит следующим образом.</p>
  <p>Для примера рассмотрим портал (2,3). Мы можем подсчитать, что суммарная энергия, потребляемая этим порталом, к концу процесса составит 32. Так как 32mod2=0 и t2,3=0, этот портал будет считаться хорошим.</p>
  </details>
</article>


<!-- Задача H. MEX и манипуляции с деревом -->
<article class="article">
  <div class="anchor" id="task8"></div>
  <h3>Задача H. MEX и манипуляции с деревом</h3>

  <div><i>Ограничение по времени 5с
  <br>Ограничение по памяти 512мб</i></div>

  <p>Для корневого дерева определим значение вершины u в дереве рекурсивно как MEX† значений её детей. Обратите внимание, что это только дети, а не все её потомки. В частности, значение листа равно 0.</p>

  <p>У Пака Чанека есть корневое дерево, которое изначально содержит только одну вершину с индексом 1, являющуюся корнем. Пак Чанек будет исполнять q запросов. В i-м запросе Паку Чанеку задано целое число xi. Паку Чанеку нужно добавить новую вершину с индексом i+1 в качестве ребенка вершины xi. После добавления новой вершины Пак Чанек должен пересчитать значения всех вершин и сообщить сумму значений всех вершин в текущем дереве.</p>

  <p>† MEX (minimum excluded) массива это наименьшее неотрицательное целое число, которого нет в массиве. Например, MEX массива [0,1,1,2,6,7] равен 3, а MEX [6,9] равен 0.</p>

  <h4>Входные данные</h4>
  <p>Первая строка входных данных содержит целое число q (1 ≤ q ≤ 3⋅10⁵) — количество запросов.</p>

  <p>Каждая из следующих q строк содержит целое число xi (1 ≤ xi ≤ i) — описание i-го запроса.</p>

  <h4>Выходные данные</h4>
  <p>Для каждого запроса выведите строку, содержащую целое число — сумму новых значений всех вершин в дереве после добавления вершины.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
7
1
1
3
2
5
2
1
</pre>
<pre>
1
1
3
2
4
4
7
</pre>

    <h4>Пример 2</h4>
<pre>
8
1
1
1
1
5
6
7
8
</pre>
<pre>
1
1
1
1
3
2
4
3
</pre>
  <p>В первом примере после 6-го запроса дерево примет следующий вид.</p>
  <ul>
    <li>Вершина 7 — лист, поэтому её значение равно 0.</li>
    <li>Вершина 6 — лист, поэтому её значение равно 0.</li>
    <li>Вершина 5 имеет единственного ребенка со значением 0, поэтому её значение равно 1.</li>
    <li>Вершина 4 — лист, поэтому её значение равно 0.</li>
    <li>Вершина 3 имеет единственного ребенка со значением 0, поэтому её значение равно 1.</li>
    <li>Вершина 2 имеет детей со значениями 0 и 1, поэтому её значение равно 2.</li>
    <li>Вершина 1 имеет детей со значениями 1 и 2, поэтому её значение равно 0.</li>
  </ul>
  <p>Сумма значений всех вершин равна 0+0+1+0+1+2+0=4.</p>
  </details>
</article>


<!-- Задача I. Хрустальные шары -->
<article class="article">
  <div class="anchor" id="task9"></div>
  <h3>Задача I. Хрустальные шары</h3>

  <div><i>Ограничение по времени 4с
  <br>Ограничение по памяти 512мб</i></div>

  <p>В мире Compfestnesia Пак Чанек нашел секретное подземелье. Внутри него находится сундук с сокровищами, окруженный n статуями, расположенными по кругу. Статуи пронумерованы от 0 до n-1, причем статуя i находится слева от статуи i+1, а статуя n-1 — слева от статуи 0.</p>

  <p>Пак Чанек заметил, что каждая статуя держит хрустальный шар с целым числом от 0 до m-1 включительно. В хрустальном шаре статуи i содержится число ai.</p>

  <p>В подземелье есть инструкция, согласно которой, чтобы открыть сундук с сокровищами, все целые числа в хрустальных шарах должны быть равны 0. Для этого Паку Чанеку дается целое число k, и он может выполнить ноль или более операций. За одну операцию Пак Чанек делает следующее:</p>
  <ol>
    <li>Он выберет ровно k последовательных статуй. Другими словами, выберет статуи p,(p+1)modn,(p+2)modn,(p+3)modn,…,(p+k-1)modn для некоторого выбранного индекса p.</li>
    <li>Выполнит одно из следующих действий:
      <ul>
        <li>Для каждой выбранной статуи заменит её значение ai на (ai+1)modm.</li>
        <li>Для каждой выбранной статуи заменит её значение ai на (ai-1)modm.</li>
      </ul>
    </li>
  </ol>
  <p>Помогите Паку Чанеку найти минимально возможное количество операций, чтобы открыть сундук с сокровищами.</p>

  <h4>Входные данные</h4>
  <p>Первая строка содержит три целых числа n, m и k (2 ≤ n, m ≤ 10⁶, nm ≤ 2⋅10⁶, 1 ≤ k &lt; n) — количество статуй, верхнее ограничение на значения чисел в хрустальных шарах и количество статуй, которые можно изменять за одну операцию.</p>

  <p>Вторая строка содержит n целых чисел a0, a1, …, a<sub>n-1</sub> (0 ≤ ai &lt; m) — целые числа в хрустальных шарах.</p>

  <h4>Выходные данные</h4>
  <p>Если возможно выполнить ноль или более операций так, чтобы стало a0=a1=…=a<sub>n-1</sub> = 0, выведите минимальное требуемое количество операций. В противном случае выведите -1.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
5 9 3
8 1 4 5 0
</pre>
  <code>7</code>

    <h4>Пример 2</h4>
<pre>
4 4 2
1 0 0 0
</pre>
  <code>-1</code>

    <h4>Пример 3</h4>
<pre>
5 5 2
1 0 0 0 0
</pre>
  <code>10</code>
  <p>В первом примере Пак Чанек может выполнять следующие операции:</p>
  <ol>
    <li>Выполнить операцию ai:=(ai-1)modm 3 раза для статуй 1, 2 и 3. Теперь a=[8,7,1,2,0].</li>
    <li>Выполнить операцию ai:=(ai-1)modm 1 раз для статуй 3, 4 и 0. Теперь a=[7,7,1,1,8].</li>
    <li>Выполнить операцию ai:=(ai+1)modm 2 раза для статуй 4, 0 и 1. Теперь a=[0,0,1,1,1].</li>
    <li>Выполнить операцию ai:=(ai-1)modm 1 раз для статуй 2, 3 и 4. Теперь a=[0,0,0,0,0].</li>
  </ol>
  </details>
</article>

