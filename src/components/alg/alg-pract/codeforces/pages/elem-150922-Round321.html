<article class="article">
  <a href="https://codeforces.com/contest/580" target="_blank">Codeforces 580 Round 321 (Div. 2) 2015-09-22</a>
</article>


<!-- Содержание -->
<article class="article">
  <h2>Содержание</h2>

      <a href="#task1">Задача A. Кефа и первые шаги</a>
  <br><a href="#task2">Задача B. Кефа и компания</a>
  <br><a href="#task3">Задача C. Кефа и парк</a>
  <br><a href="#task4">Задача D. Кефа и блюда</a>
  <br><a href="#task5">Задача E. Кефа и часы</a>
</article>


<!-- Задача A. Кефа и первые шаги -->
<article class="article">
  <div class="anchor" id="task1"></div>
  <h3>Задача A. Кефа и первые шаги</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

  <details>
    <summary>Решение</summary>

    <h4>Тест 9</h4>
<pre>
1
1
</pre>
    <code>1</code>
<pre>
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;

using namespace std;

int main() {
  // ввод данных
  int n;
  cin >> n;
  vector&lt;int&gt; A(n);
  for (int i = 0; i &lt; n; i++) {
    cin >> A[i];
  }

  // решение
  int res = 0;
  int cnt = 1;
  for (int i = 1; i &lt; n; i++) {
    if (A[i] >= A[i - 1]) {
      cnt++;
    } else {
      res = max(res, cnt);
      cnt = 1;
    }
  }
  res = max(res, cnt);

  // вывод результата
  cout &lt;&lt; res;
}
</pre>
  </details>
</article>


<!-- Задача B. Кефа и компания -->
<article class="article">
  <div class="anchor" id="task2"></div>
  <h3>Задача B. Кефа и компания</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

  <p>Кефа хочет отметить свой первый крупный заработок походом в ресторан. Однако ему нужна компания.</p>

  <p>У Кефы есть n друзей, каждый из которых согласится пойти в ресторан, если Кефа попросит. Каждый друг характеризуется количеством денег у него и степенью дружбы с Кефой. Наш попугай не хочет, чтобы какой-то друг почувствовал себя бедным по сравнению с кем-то другим в компании (Кефа не в счет). Друг чувствует себя бедным, если в компании есть кто-то, у кого денег хотя бы на d единиц больше, чем у него. Также Кефа хочет, чтобы суммарная степень дружбы членов компании была максимальной. Помогите ему пригласить оптимальную компанию!</p>

  <h4>Входные данные</h4>
  <p>Первая строка ввода содержит два целых числа, разделенных пробелом, n и d (1 ≤ n ≤ 10<sup>5</sup>, 1 ≤ d ≤ 10<sup>9</sup>) — количество друзей у Кефы и минимальная разница денег, приводящая к тому, что человек чувствует себя бедным.</p>

  <p>В последующих n строках даны описания друзей Кефы, в (i + 1)-й строке содержится описание i-го друга вида m<sub>i</sub>, s<sub>i</sub> (0 ≤ m<sub>i</sub>, s<sub>i</sub> ≤ 10<sup>9</sup>) — количество денег и степень дружбы с Кефой соответственно.</p>

  <h4>Выходные данные</h4>
  <p>Выведите максимальную суммарную степень дружбы, которой можно добиться.</p>

  <details>
    <summary>Примеры</summary>
    <h4>Пример 1</h4>
<pre>
4 5
75 5
0 100
150 20
75 1
</pre>
    <code>100</code>
    <p>В первом тесте из условия выгоднее всего сформировать компанию только из второго друга. При всех других вариантах суммарная степень дружбы будет меньше.</p>

    <h4>Пример 2</h4>
<pre>
5 100
0 7
11 32
99 10
46 8
87 54
</pre>
    <code>111</code>
    <p>Во втором тесте из условия мы можем взять всех друзей.</p>
  </details>

  <details>
    <summary>Решение</summary>

    <div>
      <a href="https://codeforces.com/contest/580/problem/B" target="_blank">Задача 580B</a>
      <br><a href="https://codeforces.com/contest/580" target="_blank">Codeforces Round 321 (Div. 2) 2015-09-22</a>
    </div>

    <p>Метод скользящего окна с переменной шириной.</p>
<pre>
#include &lt;iostream&gt;
#include &lt;vector&gt;

using namespace std;

bool compare(pair&lt;int, int&gt; a, pair&lt;int, int&gt; b) {
  return a.first &lt; b.first;
}

int main() {
  // входные данные
  int n, d;
  cin >> n >> d;
  vector&lt;pair&lt;int, int&gt; &gt; A(n);
  for (int i = 0; i &lt; n; i++) {
    cin >> A[i].first >> A[i].second;
  }

  // решение
  long long cnt = 0, res = 0;
  int pl = 0, pr = 0;
  sort(A.begin(), A.end(), compare);

  while (pl &lt; n) {
    while ( (pr &lt; n) && (abs(A[pr].first - A[pl].first) &lt; d) ) {
      cnt += A[pr].second;
      pr++;
    }
    res = max(res, cnt);
    cnt -= A[pl].second;
    pl++;
  }

  // вывод результата
  cout &lt;&lt; res;
}
</pre>
  </details>
</article>


<!-- Задача C. Кефа и парк -->
<article class="article">
  <div class="anchor" id="task3"></div>
  <h3>Задача C. Кефа и парк</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

  <details>
    <summary>Решение</summary>
<pre>
#include &lt;iostream&gt;
#include &lt;math.h&gt;
#include &lt;algorithm&gt;
#include &lt;stdio.h&gt;
#include &lt;vector&gt;

#define F first
#define S second
#define P system("PAUSE");
#define H return 0;
#define pb push_back

using namespace std;

const long long A=100000000000000LL,N=228228;

vector&lt;long long&gt; a[N];
long long c[N],o,x,y,i,j,n,m;

void go(int v, int pr, int k){
  if (k > m) return;
  int ok = 1;
  for (int i = 0; i &lt; a[v].size(); i++) if (a[v][i] != pr) ok=0, go(a[v][i], v, k*c[a[v][i]] + c[a[v][i]]);
  o += ok;
}

int main(){
  cin >> n >> m;
  for (i = 0; i &lt; n; i++) scanf("%d", &c[i]);
  for (i = 1; i &lt; n; i++) scanf("%d%d", &x, &y), x--, y--, a[x].pb(y), a[y].pb(x);
  go (0, -1, c[0]);
  cout &lt;&lt; o &lt;&lt; "\n";
}
</pre>
  </details>
</article>


<!-- Задача D. Кефа и блюда -->
<article class="article">
  <div class="anchor" id="task4"></div>
  <h3>Задача D. Кефа и блюда</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

  <details>
    <summary>Решение</summary>
<pre>
#include &lt;iostream&gt;
#include &lt;math.h&gt;
#include &lt;algorithm&gt;
#include &lt;stdio.h&gt;
#include &lt;vector&gt;

#define F first
#define S second
#define P system("PAUSE");
#define H return 0;
#define pb push_back

using namespace std;

const long long A=100000000000000LL,N=1228228;

long long mask,i,j,n,m,k,a[N],b[N],x,y,z,c[21][21],o,ot,dp[N][21];

long long len(long long mask){
  long long k = 0;
  for (i = 0; i &lt; n; i++) if (mask&b[i]) k++;
  return k;
}

int main(){
  cin >> n >> m >> k;
  for (i = 0; i &lt; n; i++) scanf("%d", &a[i]);
  b[0] = 1;
  for (i = 1; i &lt;= n; i++) b[i] = b[i-1] * 2;
  while (k--) scanf("%d%d%d", &x, &y, &z), c[x-1][y-1] = z;
  for (i = 0; i &lt; n; i++) dp[b[i]][i] = a[i];
  for (mask = 0; mask &lt; b[n]; mask++) for (i = 0; i &lt; n; i++) if (mask&b[i]) {
    for (j = 0; j &lt; n; j++) if((mask&b[j]) == 0) dp[(mask|b[j])][j] = max(dp[(mask|b[j])][j], dp[mask][i] + c[i][j]+a[j]);
  }
  for (mask = 0; mask &lt; b[n]; mask++) if (len(mask) == m) for (i = 0; i &lt; n; i++) o = max(o, dp[mask][i]);
  cout &lt;&lt; o &lt;&lt; "\n";
}
</pre>
  </details>
</article>


<!-- Задача E. Кефа и часы -->
<article class="article">
  <div class="anchor" id="task5"></div>
  <h3>Задача E. Кефа и часы</h3>

  <div><i>Ограничение по времени 1.5с
  <br>Ограничение по памяти 256мб</i></div>

  <details>
    <summary>Решение</summary>
<pre>
#include &lt;iostream&gt;
#include &lt;math.h&gt;
#include &lt;algorithm&gt;
#include &lt;stdio.h&gt;
#include &lt;vector&gt;

#define F first
#define S second
#define P system("PAUSE");
#define H return 0;
#define pb push_back

using namespace std;

const long long A=100000000000000LL,N=228228;
const long long os[2]={11,13};
const long long MOD[2]={1000000007,1073676287};

string a;
long long t[2][2][N*4],st[2][N],dp[2][N],type,l,r,d,i,j,n,m[2];

long long Get(int k, int l, int r){
  l--,r--;
  if(!l)return dp[k][r];else return ((dp[k][r]-dp[k][l-1])%MOD[k]+MOD[k])%MOD[k];
}

void push(int k, int v, int l, int r){
  if(!t[k][1][v])return;
  int mid=(l+r)/2;
  t[k][0][v*2]=(t[k][1][v]*Get(k,l,mid))%MOD[k];
  t[k][0][v*2+1]=(t[k][1][v]*Get(k,mid+1,r))%MOD[k];
  t[k][1][v*2]=t[k][1][v*2+1]=t[k][1][v];
  t[k][1][v]=0;
}

void modi(int k,int v,int l,int r,int _l,int _r,long long g){
  if(_l>_r)return;
  if(l==_l && r==_r){
      t[k][0][v]=(g*Get(k,l,r))%MOD[k],t[k][1][v]=g;
      return;
  }
  int mid=(l+r)/2;
  push(k,v,l,r);
  modi(k,v*2,l,mid,_l,min(_r,mid),g),modi(k,v*2+1,mid+1,r,max(mid+1,_l),_r,g);
  t[k][0][v]=t[k][0][v*2]+t[k][0][v*2+1];
}

long long get(int k,int v,int l,int r,int _l,int _r){
  if(_l>_r)return 0;
  if(l==_l && r==_r)return t[k][0][v];
  push(k,v,l,r);
  int mid=(l+r)/2;
  return (get(k,v*2,l,mid,_l,min(mid,_r))+get(k,v*2+1,mid+1,r,max(mid+1,_l),_r))%MOD[k];
}

int main(){
  cin>>n>>m[0]>>m[1];
  cin>>a;
  for (d = 0; d &lt; 2; d++) {
    st[d][0] = dp[d][0]=1;
    for (i = 1; i &lt; n; i++) st[d][i] = st[d][i-1] * os[d], st[d][i] %= MOD[d], dp[d][i] = dp[d][i-1] + st[d][i], dp[d][i] %= MOD[d];
    for (i = 0; i &lt; n; i++) modi(d,1,1,n,i+1,i+1,a[i]-'0'+1);
  }
  m[0] += m[1];
  while (m[0]--) {
    scanf("%d%d%d%d", &type, &l, &r, &d);
    if (type == 1){
      for (i = 0; i &lt; 2; i++) modi(i,1,1,n,l,r,d+1);
    } else {
      if (l == r || (((get(0,1,1,n,l,r-d)*st[0][d]) % OD[0] == get(0,1,1,n,l+d,r)) &&
        ((get(1,1,1,n,l,r-d)*st[1][d])%MOD[1] == get(1,1,1,n,l+d,r)))) puts("YES"); else puts("NO");
    }
  }
}
</pre>
  </details>
</article>

