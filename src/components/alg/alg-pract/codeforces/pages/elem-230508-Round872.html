<article class="article">
  <a href="https://codeforces.com/contest/1824" target="_blank">Codeforces 1824 Round 872 (Div. 1) 2023-05-08</a>
</article>


<!-- Содержание -->
<article class="article">
  <h2>Содержание</h2>

      <a href="#task3">Задача A. LuoTianyi и шоу</a>
  <br><a href="#task4">Задача B1. LuoTianyi и летающие острова (простая версия)</a>
  <br><a href="#task5">Задача B2. LuoTianyi и летающие острова (сложная версия)</a>
  <br><a href="#task6">Задача C. LuoTianyi и XOR-дерево</a>
  <br><a href="#task7">Задача D. LuoTianyi и функция</a>
  <br><a href="#task8">Задача E. LuoTianyi и Картридж</a>
</article>


<article class="article">
  <a href="https://codeforces.com/contest/1825" target="_blank">Codeforces 1825 Round 872 (Div. 2) 2023-05-08</a>
</article>


<!-- Содержание -->
<article class="article">
  <h2>Содержание</h2>

      <a href="#task1">Задача A. LuoTianyi и строка-палиндром</a>
  <br><a href="#task2">Задача B. LuoTianyi и таблица</a>
  <br><a href="#task3">Задача C. LuoTianyi и шоу</a>
  <br><a href="#task4">Задача D1. LuoTianyi и летающие острова (простая версия)</a>
  <br><a href="#task5">Задача D2. LuoTianyi и летающие острова (сложная версия)</a>
  <br><a href="#task6">Задача E. LuoTianyi и XOR-дерево</a>
</article>


<!-- Задача A. LuoTianyi и строка-палиндром -->
<article class="article">
  <div class="anchor" id="task1"></div>
  <h3>Задача A. LuoTianyi и строка-палиндром</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

</article>


<!-- Задача B. LuoTianyi и таблица -->
<article class="article">
  <div class="anchor" id="task2"></div>
  <h3>Задача B. LuoTianyi и таблица</h3>

  <div><i>Ограничение по времени 1с
  <br>Ограничение по памяти 256мб</i></div>

</article>


<!-- Задача C. LuoTianyi и шоу -->
<article class="article">
  <div class="anchor" id="task3"></div>
  <h3>Задача C. LuoTianyi и шоу</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

  <p>В шоу о VOCALOID принимают участие n человек. Они будут сидеть в ряду с сиденьями, пронумерованными от 1 до m слева направо.</p>

  <p>Все n людей приходят и садятся по порядку. Каждый человек занимает место одним из трёх способов:</p>
  <ol>
    <li>Сесть на соседнее слева место от самого левого человека, который уже сидит, или, если место 1 занятно, то покинуть шоу. Если сейчас никто не сидит, то занять место с номером m.</li>
    <li>Сесть на соседнее справа место от самого правого человека, который уже сидит, или, если место m занятно, то покинуть шоу. Если сейчас никто не сидит, то занять место с номером 1.</li>
    <li>Сесть на место с номером x<sub>i</sub>. Если это место занято, то покинуть шоу.</li>
  </ol>
  <p>Теперь вы хотите узнать, каково максимальное количество тех, кто может занять место, если вы можете впустить людей на шоу в любом порядке?</p>

  <h4>Входные данные</h4>
  <p>Каждый тест состоит из нескольких наборов входных данных. Первая строка содержит единственное целое число t (1 ≤ t ≤ 10⁴) — количество наборов входных данных. Далее следует описание наборов входных данных.</p>

  <p>Первая строка каждого набора входных данных содержит два целых числа n и m (1 ≤ n, m ≤ 10⁵) — количество людей и количество мест.</p>

  <p>Вторая строка каждого набора входных данных содержит n
  целых чисел x₁, x₂, ... ,xₙ (-2 ≤ xᵢ ≤ m, xᵢ ≠ 0), i-е из которых описывает способ, как i-й человек занимает место:</p>
  <ol>
    <li>Если xᵢ = -1, то i-й человек занимает место первым способом.</li>
    <li>Если xᵢ = -2, то i-й человек занимает место вторым способом.</li>
    <li>Если xᵢ > 0, то i-й человек занимает место третьим способом, т.е. хочет сесть на место с номером xᵢ или покинуть шоу, если оно занято.</li>
  </ol>
  <p>Гарантируется, что сумма n и сумма m по всем наборам входных данных не превосходят 10⁵.</p>

  <h4>Выходные данные</h4>
  <p>Для каждого набора входных данных выведите единственное целое число — максимальное количество человек, которые могут занять место.</p>

  <details>
    <summary>Пример</summary>
<pre>
10
3 10
5 5 5
4 6
1 -2 -2 1
5 7
-1 -1 4 -2 -2
6 7
5 -2 -2 -2 -2 -2
6 6
-1 1 4 5 -1 4
6 8
-1 -1 -1 3 -1 -2
6 7
5 -1 -2 -2 -2 -2
3 1
-2 -2 1
2 5
5 -2
1 2
-1
</pre>
<pre>
1
3
5
6
5
5
5
1
2
1
</pre>
    <summary>Примечание к примеру</summary>
    <p><strong>В первом наборе</strong> входных данных все люди хотят занять место 5, поэтому только 1 человек сможет занять место.</p>

    <p><strong>Во втором наборе</strong> входных данных людей можно впустить в порядке 1,2,3,4, тогда все люди, кроме последнего, смогут занять место.</p>

    <p><strong>В третьем наборе</strong> входных данных мы можем впускать людей на шоу в таком порядке:</p>

    <p>Впустим третьего человека:</p>

    <p>–	–	–	3	–	–	–</p>
    <p>Впустим четвёртого человека:</p>

    <p>–	–	–	3	4	–	–</p>
    <p>Впустим пятого человека:</p>

    <p>–	–	–	3	4	5	–</p>
    <p>Впустим первого человека:</p>

    <p>–	–	1	3	4	5	–</p>
    <p>Впустим второго человека:</p>

    <p>–	2	1	3	4	5	–</p>
    <p>Таким образом, все 5 человек заняли места.</p>

    <p><strong>В пятом наборе</strong> входных данных мы можем впускать людей на шоу в таком порядке:</p>

    <p>Впустим четвёртого человека:</p>

    <p>–	–	–	–	4	–</p>
    <p>Впустим третьего человека:</p>

    <p>–	–	–	3	4	–</p>
    <p>Впустим шестого человека, он покинет шоу, потому что занимает место третьим способом и должен сесть на место 4, но оно уже занято:</p>

    <p>–	–	–	3	4	–</p>
    <p>Впустим пятого человека:</p>

    <p>–	–	5	3	4	–</p>
    <p>Впустим первого человека:</p>

    <p>–	1	5	3	4	–</p>
    <p>Впустим второго человека:</p>

    <p>2	1	5	3	4	–</p>
    <p>Таким образом, 5 человек заняли места.</p>

    <p><strong>В седьмом наборе</strong> входных данных мы можем впускать людей на шоу в таком порядке:</p>

    <p>Впустим третьего человека:</p>

    <p>3	–	–	–	–	–	–</p>
    <p>Впустим четвёртого человека:</p>

    <p>3	4	–	–	–	–	–</p>
    <p>Впустим пятого человека:</p>

    <p>3	4	5	–	–	–	–</p>
    <p>Впустим шестого человека:</p>

    <p>3	4	5	6	–	–	–</p>
    <p>Впустим первого человека:</p>

    <p>3	4	5	6	1	–	–</p>
    <p>Впустим второго человека, он покинет шоу, потому что занимает место первым способом, но место 1 занято:</p>

    <p>3	4	5	6	1	–	–</p>
    <p>Таким образом, 5 человек заняли места.</p>
  </details>

  <details>
    <summary>Ещё тесты</summary>

    <h4>Тест 2</h4>
<pre>
33
1 4
1
3 3
-1 -2 -2
5 2
1 -1 -2 -2 -1
4 3
-1 -1 -1 -2
3 1
-2 -2 1
2 5
5 -2
1 2
-1
5 4
2 3 -2 1 -2
4 5
2 -2 -2 -2
3 2
1 -2 -1
1 3
3
3 1
-2 1 1
2 5
2 -1
5 2
1 -1 -1 -2 2
5 5
-1 1 -2 -2 1
4 5
-2 2 -2 -1
3 4
-1 -2 -1
4 2
1 2 1 2
4 2
-2 -2 1 -2
5 2
2 2 -2 1 2
4 5
4 -1 -1 -1
1 4
-2
4 2
-1 -2 -1 -2
2 2
-2 2
4 1
-2 -2 -1 -1
4 3
-1 3 -2 -2
2 3
-1 -2
3 1
-2 1 -1
5 2
-1 -2 1 -2 -1
5 4
3 -2 -1 1 -2
5 2
-1 -2 2 -1 2
3 3
-2 1 -1
2 1
-1 -1
</pre>
<code>1 2 2 3 1 2 1 4 4 2 1 1 2 2 3 4 2 2 2 2 4 1 2 2 1 3 1 1 2 4 2 2 1</code>

    <h4>Тест 4</h4>
<pre>
1
100 120
-1 72 18 -1 5 -2 70 -1 -1 18 -2 33 93 -1 -2 -2 -2 -2 78 114 -2
65 -2 -1 74 48 16 70 63 -2 94 118 61 108 40 48 105 73 113 103
75 16 22 53 -1 62 47 -2 2 16 56 117 74 102 92 -1 79 98 28 120
72 113 31 43 -1 4 84 58 92 41 44 45 -1 67 -1 -2 -2 -2 35 45 -1
66 119 -1 84 -1 49 97 -2 84 103 10 -2 33 22 112 -1 38 118 65
</pre>
    <code>83</code>

    <h4>Тест</h4>
<pre>
2
6 6
2 5 -1 -1 -2 -2
8 10
2  9 -1 -1 -1 -2 -2 -2
</pre>
    <code>5 6</code>

    <h4>Тест</h4>
<pre>
2
7 5
3 -1 -1 -1 -2 -2 -2
8 6
3 -1 -1 -1 -2 -2 -2 -2
</pre>
    <code>5 6</code>
  </details>

  <details>
    <summary>Решение за O(n)</summary>

    <div>
      <a href="https://codeforces.com/contest/1824/problem/A" target="_blank">Задача 1824A</a>
      <br><a href="https://codeforces.com/contest/1824" target="_blank">Codeforces Round 872 (Div. 1) 2023-05-08</a>
    </div>

    <p>Посчитаем количество человек с первым способом cnt1, со вторым способом cnt2, с третьим способом cnt3.</p>
    <p>Если с третьим способом никого нет, то людей можно рассадить только первым или только вторым, выбираем из них максимум.</p>
    <p>Если с третьим способом кто-нибудь есть, то нужно рассмотреть четыре варианта и выбрать из них максимум. Каждый вариант это простой проход по циклу, поэтому <strong>сложность O(n)</strong></p>
    <p>1 вариант. начинаем сажать слева первым способом учитывая занятые места</p>
<pre>
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;

using namespace std;

int main() {
  // ускорение ввода-вывода
  ios::sync_with_stdio(0);
  cin.tie(0);

  // ввод данных
  int t;
  cin >> t;

  while (t--) {
    int n, m;
    cin >> n >> m;

    // все места в зале
    // 1 - занято
    // 0 - свободно
    vector&lt;int&gt; A(m + 1, 0);

    int cnt1 = 0, cnt2 = 0, cnt3 = 0;
    int tmp;

    // заполняем входные данные
    for (int i = 0; i &lt; n; i++) {
      cin >> tmp;
      if (tmp == -1) {
        cnt1++;
      } else if (tmp == -2) {
        cnt2++;
      } else if (tmp &lt;= m && A[tmp] == 0) {
        A[tmp] = 1;
        cnt3++;
      }
    }

    // решение
    int res = 0;

    // если третим способом никого нет
    // то можно посадить только слева или справа
    // выберем из них максимум
    if (cnt3 == 0) {
      res = max(cnt1, cnt2);

      // результат не может быть больше числа мест
      res = min(res, m);

      // если третим способом кто-то есть
      // то рассмотрим 4 варианта
    } else {

      // 3 вариант
      // учитывая занятые места
      int cnt1a = cnt1;
      int res3 = 0;
      int res30 = 0;
      int prev = 0;
      int next = m + 1;
      for (int i = 1; i &lt;= m; i++) {
        // начинаем сажать слева первым способом
        if (A[i] == 0 && cnt1a > 0) {
          res3++;
          cnt1a--;
        }
        // предыдущее занятое место
        if (A[i] == 1 && cnt1a > 0) {
          res30 = res3;
          prev = i;
        }
        // следующее занятое место
        if (A[i] == 1 && cnt1a == 0) {
          next = i;
          break;
        }
      }
      int cnt2a = cnt2;
      int res31 = 0;
      for (int i = prev + 1; i &lt;= m; i++) {
        // начинаем сажать справа вторым способом
        if (A[i] == 0 && cnt2a > 0) {
          res31++;
          cnt2a--;
        }
      }
      cnt2a = cnt2;
      int res32 = 0;
      for (int i = next + 1; i &lt;= m; i++) {
        // начинаем сажать справа вторым способом
        if (A[i] == 0 && cnt2a > 0) {
          res32++;
          cnt2a--;
        }
      }
      res3 = cnt3 + max(res30 + res31, res3 + res32);

      // 4 вариант
      // учитывая занятые места
      cnt2a = cnt2;
      int res4 = 0;
      int res40 = 0;
      prev = m + 1;
      next = 0;
      for (int i = m; i > 0; i--) {
        // начинаем сажать справа вторым способом
        if (A[i] == 0 && cnt2a > 0) {
          res4++;
          cnt2a--;
        }
        // предыдущее занятое место
        if (A[i] == 1 && cnt2a > 0) {
          res40 = res4;
          prev = i;
        }
        // следующее занятое место
        if (A[i] == 1 && cnt2a == 0) {
          next = i;
          break;
        }
      }
      cnt1a = cnt1;
      int res41 = 0;
      for (int i = prev - 1; i > 0; i--) {
        // начинаем сажать слева первым способом
        if (A[i] == 0 && cnt1a > 0) {
          res41++;
          cnt1a--;
        }
      }
      cnt1a = cnt1;
      int res42 = 0;
      for (int i = next - 1; i > 0; i--) {
        // начинаем сажать слева первым способом
        if (A[i] == 0 && cnt1a > 0) {
          res42++;
          cnt1a--;
        }
      }
      res4 = cnt3 + max(res40 + res41, res4 + res42);

      res = max(res, max(res3, res4));
      res = min(res, m);
    }

    // вывод результата
    std::cout &lt;&lt; res &lt;&lt; '\n';
  }
}
</pre>
  </details>
</article>


<!-- Задача D1. LuoTianyi и летающие острова (простая версия) -->
<article class="article">
  <div class="anchor" id="task4"></div>
  <h3>Задача D1. LuoTianyi и летающие острова (простая версия)</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

</article>


<!-- Задача D2. LuoTianyi и летающие острова (сложная версия) -->
<article class="article">
  <div class="anchor" id="task5"></div>
  <h3>Задача D2. LuoTianyi и летающие острова (сложная версия)</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

</article>


<!-- Задача E. LuoTianyi и XOR-дерево -->
<article class="article">
  <div class="anchor" id="task6"></div>
  <h3>Задача E. LuoTianyi и XOR-дерево</h3>

  <div><i>Ограничение по времени 2с
  <br>Ограничение по памяти 256мб</i></div>

</article>


<!-- Задача D. LuoTianyi и функция -->
<article class="article">
  <div class="anchor" id="task7"></div>
  <h3>Задача D. LuoTianyi и функция</h3>

  <div><i>Ограничение по времени 7с
  <br>Ограничение по памяти 1024мб</i></div>

</article>


<!-- Задача E. LuoTianyi и Картридж -->
<article class="article">
  <div class="anchor" id="task8"></div>
  <h3>Задача E. LuoTianyi и Картридж</h3>

  <div><i>Ограничение по времени 3с
  <br>Ограничение по памяти 1024мб</i></div>

</article>

